### ===========================================
### MÓDULO DE PEDIDOS (ORDERS)
### ===========================================
### Base URL: http://localhost:3000/api/orders
### Todos os endpoints requerem autenticação
### ===========================================
###
### IMPORTANTE:
### Este módulo é para CONSULTA de pedidos já criados.
### Para CRIAR pedidos, use o módulo /checkout (ver checkout.http)
###
### FLUXO DE CRIAÇÃO (resumo):
### 1. Adicionar produtos ao carrinho (via /carts)
### 2. POST /checkout/guest ou /checkout/registered
### 3. POST /checkout/order (com X-Idempotency-Key)
### 4. POST /checkout/payment/:type/gateway/:gateway (com X-Idempotency-Key)
### 5. Consultar pedido aqui (GET /orders/:id)
###
### PREÇOS:
### Os valores dos itens são capturados do marketplace no momento
### da criação do pedido (finalPrice do anúncio ativo).
### ===========================================

@baseUrl = http://localhost:3000/api
@ordersUrl = {{baseUrl}}/orders
@authUrl = {{baseUrl}}/auth
@contentType = application/json

### ===========================================
### AUTENTICAÇÃO
### ===========================================

# @name login
POST {{authUrl}}/signin
Content-Type: {{contentType}}

{
  "email": "usuario@email.com",
  "password": "Senha123"
}

@token = {{login.response.body.access_token}}
@profileId = {{login.response.body.profileId}}

### ===========================================
### 1. LISTAR PEDIDOS DO PERFIL
### ===========================================
### Retorna resumo dos pedidos do usuário logado
### Requer: Authorization Bearer token

### Listar todos os pedidos do usuário logado
GET {{ordersUrl}}
Authorization: Bearer {{token}}

### ===========================================
### FILTROS DISPONÍVEIS
### ===========================================

### Filtrar por status - AGUARDANDO PAGAMENTO
GET {{ordersUrl}}?status=WAITING_PAYMENT
Authorization: Bearer {{token}}

### Filtrar por status - PAGOS AGUARDANDO ENVIO
GET {{ordersUrl}}?status=PAID_WAITING_SHIP
Authorization: Bearer {{token}}

### Filtrar por status - EM TRÂNSITO
GET {{ordersUrl}}?status=IN_TRANSIT
Authorization: Bearer {{token}}

### Filtrar por status - CONCLUÍDOS
GET {{ordersUrl}}?status=CONCLUDED
Authorization: Bearer {{token}}

### Filtrar por status - CANCELADOS
GET {{ordersUrl}}?status=CANCELED
Authorization: Bearer {{token}}

### Filtrar por marketplace
GET {{ordersUrl}}?marketplace=ECOMMERCE
Authorization: Bearer {{token}}

### Filtrar por status + marketplace
GET {{ordersUrl}}?status=CONCLUDED&marketplace=ECOMMERCE
Authorization: Bearer {{token}}

### ===========================================
### 2. DETALHES DO PEDIDO
### ===========================================
### Retorna informações completas de um pedido específico
### Requer: Authorization Bearer token

# @name getOrder
GET {{ordersUrl}}/1
Authorization: Bearer {{token}}

@orderId = {{getOrder.response.body.id}}

### Buscar outro pedido
GET {{ordersUrl}}/2
Authorization: Bearer {{token}}

### ===========================================
### ESTRUTURA DE RESPOSTA - LISTAGEM
### ===========================================

### GET /orders - Resposta:
### [
###   {
###     "id": 1,
###     "partnerOrderId": "ECOM-42-1702123456789",
###     "status": "PAID_WAITING_SHIP",
###     "marketplace": "ECOMMERCE",
###     "paymentMethod": "CREDIT_CARD",
###     "itemsTotal": "279.70",
###     "shippingTotal": "20.00",
###     "discountTotal": "0.00",
###     "grandTotal": "299.70",
###     "createdAt": "2025-12-14T10:00:00.000Z",
###     "updatedAt": "2025-12-14T10:30:00.000Z",
###     "items": [
###       {
###         "id": 1,
###         "productId": 73414029,
###         "skuId": 30494035,
###         "title": "Mouse Gamer USB C3Tech MG-800BK",
###         "quantity": 2,
###         "unitPrice": "69.90",
###         "discount": "0.00",
###         "total": "139.80"
###       }
###     ]
###   }
### ]

### ===========================================
### ESTRUTURA DE RESPOSTA - DETALHES
### ===========================================

### GET /orders/:id - Resposta:
### {
###   "id": 1,
###   "profileId": 42,
###   "anymarketOrderId": 123456,
###   "partnerOrderId": "ECOM-42-1702123456789",
###   "checkoutKey": "550e8400-e29b-41d4-a716-446655440001",
###   "marketplace": "ECOMMERCE",
###   "marketplaceOrderId": null,
###   "status": "PAID_WAITING_SHIP",
###   "itemsTotal": "279.70",
###   "shippingTotal": "20.00",
###   "discountTotal": "0.00",
###   "grandTotal": "299.70",
###   "paymentMethod": "CREDIT_CARD",
###   "installments": 3,
###   "shippingCarrier": null,
###   "shippingService": null,
###   "shippingEstimatedDeliveryDate": null,
###   "shippingTrackingCode": null,
###   "items": [
###     {
###       "id": 1,
###       "productId": 73414029,
###       "skuId": 30494035,
###       "title": "Mouse Gamer USB C3Tech MG-800BK",
###       "quantity": 2,
###       "unitPrice": "69.90",
###       "discount": "0.00",
###       "total": "139.80"
###     }
###   ],
###   "createdAt": "2025-12-14T10:00:00.000Z",
###   "updatedAt": "2025-12-14T10:30:00.000Z"
### }

### ===========================================
### STATUS DOS PEDIDOS
### ===========================================
### 
### INCOMPLETE (0)
###   Pedido incompleto, aguardando informações
###
### PENDING (1)
###   Pedido criado localmente, aguardando integração AnyMarket
###   Próximo: WAITING_PAYMENT (após integração)
###
### WAITING_PAYMENT (2)
###   Aguardando processamento de pagamento
###   Próximo: PAID_WAITING_SHIP ou CANCELED
###
### PAID_WAITING_SHIP (3)
###   Pagamento aprovado, aguardando envio
###   Carrinho limpo automaticamente neste ponto
###   Próximo: INVOICED
###
### INVOICED (4)
###   Nota fiscal emitida
###   Próximo: PAID_WAITING_DELIVERY
###
### PAID_WAITING_DELIVERY (5)
###   Aguardando postagem/envio
###   Próximo: IN_TRANSIT
###
### IN_TRANSIT (6)
###   Em trânsito - shippingTrackingCode disponível
###   Próximo: CONCLUDED ou DELIVERY_ISSUE
###
### DELIVERY_ISSUE (7)
###   Problema na entrega (ação manual necessária)
###
### CONCLUDED (8)
###   Pedido entregue e concluído (estado final)
###
### CANCELED (9)
###   Pedido cancelado (estado final)
###
### ===========================================

### ===========================================
### MÉTODOS DE PAGAMENTO
### ===========================================
###
### PENDING (0) - Método ainda não definido
### CREDIT_CARD (1) - Cartão de crédito (1-12x)
### DEBIT_CARD (2) - Cartão de débito (à vista)
### PIX (3) - Pagamento instantâneo (à vista)
###
### ===========================================

### ===========================================
### CAMPOS IMPORTANTES PARA O FRONTEND
### ===========================================
###
### Para exibir lista de pedidos:
### - status: usar para filtros e badges de status
### - grandTotal: valor total do pedido
### - createdAt: data de criação formatada
### - items[].quantity: quantidade por item
###
### Para exibir detalhes:
### - partnerOrderId: número do pedido para exibir ao cliente
### - paymentMethod + installments: forma de pagamento
### - shippingTrackingCode: link de rastreamento (quando IN_TRANSIT)
### - items[]: lista de produtos com quantidade e valores
###
### Estados relevantes para UI:
### - WAITING_PAYMENT: exibir botão "Pagar" ou QR Code PIX
### - IN_TRANSIT: exibir link de rastreamento
### - CONCLUDED: exibir opção de avaliação
### - CANCELED: exibir motivo (se disponível)
###
### ===========================================

### ===========================================
### ERROS COMUNS
### ===========================================

### Erro 404: Pedido não encontrado
GET {{ordersUrl}}/999999
Authorization: Bearer {{token}}

### Erro 403: Pedido não pertence ao usuário logado
### (tentando acessar pedido de outro profileId)
GET {{ordersUrl}}/1
Authorization: Bearer {{token}}

### Erro 401: Token ausente ou inválido
GET {{ordersUrl}}/1

### ===========================================
### NOTAS TÉCNICAS
### ===========================================
###
### Preços dos itens:
### - unitPrice: preço capturado do marketplace (finalPrice do anúncio)
### - discount: desconto aplicado no checkout (cupom, etc)
### - total: (unitPrice * quantity) - discount
###
### Identificadores:
### - id: ID interno do pedido no banco local
### - anymarketOrderId: ID no sistema AnyMarket
### - partnerOrderId: formato ECOM-{profileId}-{timestamp}
### - checkoutKey: UUID de idempotência (interno)
###
### Integração AnyMarket:
### - Order criada localmente primeiro (status: PENDING)
### - Após integração AnyMarket: status -> WAITING_PAYMENT
### - partnerId do SKU = marketplacePartnerId do anúncio ativo
###
### Carrinho:
### - NÃO é limpo ao criar order (permite retry)
### - Limpo APENAS quando pagamento é APROVADO
###
### ===========================================
