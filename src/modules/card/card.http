### ============================================
### CARD API - Rotas de Cartões de Crédito
### ============================================
### Base URL: http://localhost:3000/api/card
### Todas as rotas requerem autenticação JWT
### ============================================

@baseUrl = http://localhost:3000/api
@cardUrl = {{baseUrl}}/card
@contentType = application/json

### ===========================================
### AUTENTICAÇÃO - Execute primeiro para obter o token
### ===========================================

# @name login
POST {{baseUrl}}/auth/signin
Content-Type: {{contentType}}

{
  "email": "pessoafisica@exemplo.com",
  "password": "senha123"
}

### Token salvo automaticamente da resposta do login
@token = {{login.response.body.access_token}}

### ============================================
### 1. CRIAR NOVO CARTÃO
### ============================================
### POST /card
### Headers: Authorization Bearer Token
### Body: { lastFourDigits, holderName, expirationMonth, expirationYear, brand, isDefault? }
### 
### NOTA: Apenas os últimos 4 dígitos são armazenados para exibição.
### Dados sensíveis (número completo, CVV) são usados apenas no pagamento.
### ============================================

### Criar cartão Visa
POST {{cardUrl}}
Authorization: Bearer {{token}}
Content-Type: {{contentType}}

{
  "lastFourDigits": "1111",
  "holderName": "João Silva",
  "expirationMonth": "12",
  "expirationYear": "2028",
  "brand": "Visa",
  "isDefault": true
}

### Criar cartão Mastercard
POST {{cardUrl}}
Authorization: Bearer {{token}}
Content-Type: {{contentType}}

{
  "lastFourDigits": "0004",
  "holderName": "Maria Santos",
  "expirationMonth": "06",
  "expirationYear": "2027",
  "brand": "Mastercard",
  "isDefault": false
}

### ============================================
### 2. LISTAR TODOS OS CARTÕES DO USUÁRIO
### ============================================
### GET /api/card
### Headers: Authorization Bearer Token
### Response: Lista de cartões com dados mascarados
### ============================================

### Listar cartões
GET {{cardUrl}}
Authorization: Bearer {{token}}

### ============================================
### 3. BUSCAR CARTÃO PADRÃO
### ============================================
### GET /api/card/default
### Headers: Authorization Bearer Token
### Response: Cartão marcado como padrão
### ============================================

### Buscar cartão padrão
GET {{cardUrl}}/default
Authorization: Bearer {{token}}

### ============================================
### 4. BUSCAR CARTÃO POR ID
### ============================================
### GET /api/card/:id
### Headers: Authorization Bearer Token
### Response: Cartão com dados mascarados
### ============================================

### Buscar cartão por ID (substitua o ID)
GET {{cardUrl}}/1
Authorization: Bearer {{token}}

### ============================================
### 5. ATUALIZAR CARTÃO
### ============================================
### PATCH /api/card/:id
### Headers: Authorization Bearer Token
### Body: { holderName?, isDefault? }
### 
### Nota: Apenas holderName e isDefault podem ser atualizados
### ============================================

### Atualizar nome do titular
PATCH {{cardUrl}}/1
Authorization: Bearer {{token}}
Content-Type: {{contentType}}

{
  "holderName": "João S. Silva"
}

### Definir cartão como padrão
PATCH {{cardUrl}}/1
Authorization: Bearer {{token}}
Content-Type: {{contentType}}

{
  "isDefault": true
}

### ============================================
### 6. REMOVER CARTÃO
### ============================================
### DELETE /api/card/:id
### Headers: Authorization Bearer Token
### Response: 204 No Content
### ============================================

### Remover cartão
DELETE {{cardUrl}}/1
Authorization: Bearer {{token}}

### ============================================
### EXEMPLOS DE ERROS
### ============================================

### Erro 401: Requisição sem token
GET {{cardUrl}}

### Erro 403: Cartão não pertence ao perfil do usuário
GET {{cardUrl}}/9999
Authorization: Bearer {{token}}

### ============================================
### EXEMPLOS DE RESPOSTA
### ============================================
###
### Criação de cartão (retorno):
### {
###   "id": 1,
###   "profileId": 1,
###   "lastFourDigits": "1111",
###   "holderName": "JOÃO S.",
###   "expirationMonth": "12",
###   "expirationYear": "2028",
###   "brand": "Visa",
###   "isDefault": true,
###   "cardToken": null,
###   "createdAt": "2024-12-11T...",
###   "updatedAt": "2024-12-11T..."
### }
###
### Listagem de cartões (retorno):
### [
###   {
###     "id": 1,
###     "lastFourDigits": "1111",
###     "holderName": "JOÃO S.",
###     "expirationMonth": "12",
###     "expirationYear": "2028",
###     "brand": "Visa",
###     "isDefault": true
###   }
### ]
### ============================================
